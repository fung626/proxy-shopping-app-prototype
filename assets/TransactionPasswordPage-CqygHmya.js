import{u as J,a as Q,r as l,j as e,B as P}from"./index-CvO9pKPC.js";import{I as D}from"./input-DnWsiyUA.js";import{S as W}from"./switch-CHqSPS1R.js";import{L as T}from"./lock-CQHeIs6o.js";import{E as R}from"./eye-off-DfQLGFcl.js";import{E as L}from"./eye-CND1pLNp.js";import{C as K}from"./check-BygKOcWJ.js";import"./index-CosQv8v_.js";import"./index-B46UinAq.js";import"./index-wsE_5AEc.js";import"./index-BUvxBgzt.js";function ie({user:f}){const{t:a}=J(),z=Q(),[N,B]=l.useState(!1),[b,F]=l.useState(!1),[v,A]=l.useState(!1),[h,y]=l.useState(["","","","","",""]),[c,C]=l.useState(["","","","","",""]),[m,S]=l.useState(["","","","","",""]),[w,O]=l.useState(f?.transaction_password_enabled||!1),[$,q]=l.useState(!1),[u,M]=l.useState({}),g=l.useRef([]),p=l.useRef([]),j=l.useRef([]),U=()=>{const s={};if(w){const t=h.join(""),n=c.join(""),r=m.join("");!f?.transaction_password_enabled&&!t||f?.transaction_password_enabled&&(!t||t.length!==6)&&(s.currentPassword=a("transactionPassword.currentPasswordRequired")),(!n||n.length!==6)&&(s.newPassword=a("transactionPassword.newPasswordRequired")),!r||r.length!==6?s.confirmPassword=a("transactionPassword.confirmPasswordRequired"):n!==r&&(s.confirmPassword=a("transactionPassword.passwordsDoNotMatch"))}return M(s),Object.keys(s).length===0},V=()=>{if(!w)return!0;const s=h.join(""),t=c.join(""),n=m.join(""),r=f?.transaction_password_enabled&&(!s||s.length!==6),o=!t||t.length!==6,d=!n||n.length!==6||t!==n;return!r&&!o&&!d},_=(s,t,n)=>{const r=t.replace(/\D/g,"");if(r.length<=1){let o,d;n==="current"?(o=[...h],d=g.current,o[s]=r,y(o)):n==="new"?(o=[...c],d=p.current,o[s]=r,C(o)):(o=[...m],d=j.current,o[s]=r,S(o)),r&&s<5&&d[s+1]?.focus()}},E=(s,t,n)=>{let r,o;n==="current"?(r=h,o=g.current):n==="new"?(r=c,o=p.current):(r=m,o=j.current),t.key==="Backspace"&&!r[s]&&s>0&&o[s-1]?.focus()},k=(s,t)=>{s.preventDefault();const n=s.clipboardData.getData("text").replace(/\D/g,"").slice(0,6);if(n){let r;t==="current"?([...h],r=g.current,y(d=>{const x=[...d];for(let i=0;i<6;i++)x[i]=n[i]||"";return x})):t==="new"?([...c],r=p.current,C(d=>{const x=[...d];for(let i=0;i<6;i++)x[i]=n[i]||"";return x})):([...m],r=j.current,S(d=>{const x=[...d];for(let i=0;i<6;i++)x[i]=n[i]||"";return x}));const o=Math.min(n.length,5);r[o]?.focus()}},G=async()=>{if(U()){q(!0);try{await new Promise(t=>setTimeout(t,1e3));const s={...f,transaction_password_enabled:w,transaction_password_set:w&&c?!0:f?.transaction_password_set||!1};console.log("Saving transaction password settings:",s),z(-1)}catch(s){console.error("Failed to update transaction password:",s)}finally{q(!1)}}},H=s=>{O(s),s||(y(["","","","","",""]),C(["","","","","",""]),S(["","","","","",""]),M({}))},I=f?.transaction_password_enabled&&f?.transaction_password_set;return e.jsx("div",{className:"min-h-screen bg-background flex flex-col",children:e.jsx("div",{className:"flex-1 px-6 py-8",children:e.jsxs("div",{className:"max-w-sm mx-auto",children:[e.jsxs("div",{className:"mb-8 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-primary/10 rounded-2xl flex items-center justify-center mx-auto mb-4",children:e.jsx(T,{className:"h-8 w-8 text-primary"})}),e.jsx("h1",{className:"text-3xl font-semibold text-foreground mb-3",children:a("transactionPassword.title")}),e.jsx("p",{className:"text-muted-foreground leading-relaxed",children:a("transactionPassword.enableDescription")})]}),e.jsx("div",{className:"mb-8 p-4 bg-muted/30 rounded-xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-foreground mb-1",children:a("transactionPassword.enableTitle")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:a(w?"transactionPassword.enabled":"transactionPassword.disabled")})]}),e.jsx(W,{checked:w,onCheckedChange:H})]})}),w&&e.jsxs("div",{className:"space-y-6",children:[I&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-sm font-medium text-foreground",children:a("transactionPassword.currentPassword")}),e.jsx(P,{type:"button",variant:"ghost",size:"sm",className:"h-auto p-1",onClick:()=>B(!N),children:N?e.jsx(R,{className:"h-4 w-4 text-muted-foreground"}):e.jsx(L,{className:"h-4 w-4 text-muted-foreground"})})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"flex space-x-3",children:[0,1,2,3,4,5].map(s=>e.jsx(D,{ref:t=>{g.current[s]=t},type:N?"text":"password",inputMode:"numeric",value:h[s],onChange:t=>_(s,t.target.value,"current"),onKeyDown:t=>E(s,t,"current"),onPaste:t=>k(t,"current"),className:`w-12 h-12 text-center text-lg font-medium bg-muted/20 border-muted rounded-xl focus:ring-2 focus:ring-primary focus:border-primary transition-all ${u.currentPassword?"border-red-500":""}`,maxLength:1,autoComplete:"off"},s))})}),u.currentPassword&&e.jsx("p",{className:"text-sm text-red-500 text-center",children:u.currentPassword})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-sm font-medium text-foreground",children:a(I?"transactionPassword.newPassword":"transactionPassword.password")}),e.jsx(P,{type:"button",variant:"ghost",size:"sm",className:"h-auto p-1",onClick:()=>F(!b),children:b?e.jsx(R,{className:"h-4 w-4 text-muted-foreground"}):e.jsx(L,{className:"h-4 w-4 text-muted-foreground"})})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"flex space-x-3",children:[0,1,2,3,4,5].map(s=>e.jsx(D,{ref:t=>{p.current[s]=t},type:b?"text":"password",inputMode:"numeric",value:c[s],onChange:t=>_(s,t.target.value,"new"),onKeyDown:t=>E(s,t,"new"),onPaste:t=>k(t,"new"),className:`w-12 h-12 text-center text-lg font-medium bg-muted/20 border-muted rounded-xl focus:ring-2 focus:ring-primary focus:border-primary transition-all ${u.newPassword?"border-red-500":""}`,maxLength:1,autoComplete:"off"},s))})}),u.newPassword&&e.jsx("p",{className:"text-sm text-red-500 text-center",children:u.newPassword})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-sm font-medium text-foreground",children:a("transactionPassword.confirmPassword")}),e.jsx(P,{type:"button",variant:"ghost",size:"sm",className:"h-auto p-1",onClick:()=>A(!v),children:v?e.jsx(R,{className:"h-4 w-4 text-muted-foreground"}):e.jsx(L,{className:"h-4 w-4 text-muted-foreground"})})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"flex space-x-3",children:[0,1,2,3,4,5].map(s=>e.jsx(D,{ref:t=>{j.current[s]=t},type:v?"text":"password",inputMode:"numeric",value:m[s],onChange:t=>_(s,t.target.value,"confirm"),onKeyDown:t=>E(s,t,"confirm"),onPaste:t=>k(t,"confirm"),className:`w-12 h-12 text-center text-lg font-medium bg-muted/20 border-muted rounded-xl focus:ring-2 focus:ring-primary focus:border-primary transition-all ${u.confirmPassword?"border-red-500":""}`,maxLength:1,autoComplete:"off"},s))})}),u.confirmPassword&&e.jsx("p",{className:"text-sm text-red-500 text-center",children:u.confirmPassword})]}),e.jsxs("div",{className:"bg-muted/30 rounded-xl p-4",children:[e.jsx("h4",{className:"text-sm font-medium mb-3 text-foreground",children:a("transactionPassword.requirements")}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`w-5 h-5 rounded-full flex items-center justify-center ${c.join("").length===6?"bg-green-500":"bg-muted-foreground"}`,children:c.join("").length===6&&e.jsx(K,{className:"w-3 h-3 text-white"})}),e.jsx("span",{className:`text-sm ${c.join("").length===6?"text-green-600":"text-muted-foreground"}`,children:a("transactionPassword.requirementLength")})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`w-5 h-5 rounded-full flex items-center justify-center ${c.join("")===m.join("")&&c.join("").length===6?"bg-green-500":"bg-muted-foreground"}`,children:c.join("")===m.join("")&&c.join("").length===6&&e.jsx(K,{className:"w-3 h-3 text-white"})}),e.jsx("span",{className:`text-sm ${c.join("")===m.join("")&&c.join("").length===6?"text-green-600":"text-muted-foreground"}`,children:a("transactionPassword.requirementMatch")})]})]})]}),e.jsx(P,{onClick:G,disabled:$||!V(),className:"w-full h-12 bg-primary hover:bg-primary/90 text-primary-foreground font-medium rounded-xl mt-8",children:a($?"common.saving":"common.save")})]}),e.jsx("div",{className:"mt-8 p-4 transaction-password-info-box rounded-xl",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"w-6 h-6 transaction-password-info-icon-bg rounded-full flex items-center justify-center flex-shrink-0 mt-0.5",children:e.jsx(T,{className:"w-3.5 h-3.5 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium transaction-password-info-title mb-1",children:a("transactionPassword.infoTitle")}),e.jsx("p",{className:"text-sm transaction-password-info-text leading-relaxed",children:a("transactionPassword.infoDescription")})]})]})})]})})})}export{ie as TransactionPasswordPage};
