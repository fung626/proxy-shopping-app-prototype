const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/wishlistStore-CfNM5_Pj.js","assets/index-CvO9pKPC.js","assets/index-C9_y_LNU.css","assets/offersSupabaseService-BThdOnLG.js","assets/requestsSupabaseService-soQQ1D_i.js"])))=>i.map(i=>d[i]);
import{u as W,a as k,r as o,c as R,j as s,B as h,_ as B}from"./index-CvO9pKPC.js";import{O as g}from"./OfferCard-Bdyy8poT.js";import{R as N}from"./RequestCardB-5Jaff5AR.js";import{I as E}from"./input-DnWsiyUA.js";import{o as L}from"./offersSupabaseService-BThdOnLG.js";import{r as A}from"./requestsSupabaseService-soQQ1D_i.js";import{u as q}from"./wishlistStore-CfNM5_Pj.js";import{S as F}from"./search-B_nDvCvE.js";import{H as M}from"./heart-DlE89daf.js";import"./badge-CXoDSUIB.js";import"./ImageWithFallback--6Rpc7vq.js";import"./common-Dk-gsxo2.js";import"./map-pin-BzPRdFpW.js";function Z(){const{t:a}=W(),S=k(),[u,C]=o.useState(""),[d,p]=o.useState("all"),[l,x]=o.useState([]),[m,y]=o.useState({}),[_,w]=o.useState(!0),{getWishlist:v,removeWishlistItem:O}=q(),j=o.useMemo(()=>v(),[v]),{user:f}=R();o.useEffect(()=>{f&&(async()=>{try{await q.getState().fetchRemoteWishlist()}catch(i){console.warn("Failed to fetch remote wishlist",i)}})()},[f]),o.useEffect(()=>{(async()=>{if(w(!0),f)try{const i=await(await B(async()=>{const{wishlistSupabaseService:e}=await import("./wishlistStore-CfNM5_Pj.js").then(r=>r.w);return{wishlistSupabaseService:e}},__vite__mapDeps([0,1,2,3,4]))).wishlistSupabaseService.getWishlistByUser(f.id),n=[],c={};for(const e of i)e.item_type==="offer"&&e.offer?(n.push({id:e.item_id,type:"offer",title:e.offer.title,price:e.offer.price,currency:e.offer.currency,location:e.offer.location,images:e.offer.images,agentName:e.offer.agent_details?.name,rating:e.offer.agent_details?.rating,reviews:e.offer.agent_details?.reviews}),c[e.item_id]=e.offer):e.item_type==="request"&&e.request&&(n.push({id:e.item_id,type:"request",title:e.request.title,budget_min:e.request.budget_min,budget_max:e.request.budget_max,currency:e.request.currency,location:e.request.expected_delivery_location,images:e.request.images,clientName:e.request.user_name}),c[e.item_id]=e.request);x(n),y(c)}catch(i){console.warn("Failed to fetch enriched wishlist, falling back",i)}if(!f){const i=[],n={};for(const c of j)try{const e=await L.getOfferById(c.id);if(e){i.push({id:e.id,type:"offer",title:e.title,price:e.price,currency:e.currency,location:e.location,images:e.images,agentName:e.agent_details?.name,rating:e.agent_details?.rating,reviews:e.agent_details?.reviews}),n[e.id]=e;continue}const r=await A.getRequestById(c.id);r&&(i.push({id:r.id,type:"request",title:r.title,budget_min:r.budget_min,budget_max:r.budget_max,currency:r.currency,location:r.expected_delivery_location,images:r.images,clientName:r.user_name}),n[r.id]=r)}catch(e){console.error("Error fetching wishlist item:",c.id,e)}x(i),y(n)}w(!1)})()},[j]);const b=o.useMemo(()=>{let t=l;return d!=="all"&&(t=t.filter(i=>i.type===d)),u.trim()&&(t=t.filter(i=>i.title.toLowerCase().includes(u.toLowerCase())||(i.type==="offer"?i.agentName:i.clientName)?.toLowerCase().includes(u.toLowerCase()))),t},[l,d,u]),I=()=>{S(-1)};return s.jsxs("div",{className:"min-h-screen bg-background",children:[s.jsx("div",{className:"safe-area-inset-top",children:s.jsxs("div",{className:"px-4 pb-4 space-y-3",children:[s.jsxs("div",{className:"relative",children:[s.jsx(F,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),s.jsx(E,{placeholder:a("wishlist.searchWishlist"),value:u,onChange:t=>C(t.target.value),className:"pl-10 bg-input-background border-0"})]}),s.jsxs("div",{className:"flex space-x-2",children:[s.jsxs(h,{variant:d==="all"?"default":"outline",size:"sm",onClick:()=>p("all"),className:"flex-1",children:[a("common.all")," (",l.length,")"]}),s.jsxs(h,{variant:d==="offer"?"default":"outline",size:"sm",onClick:()=>p("offer"),className:"flex-1",children:[a("common.offers")," (",l.filter(t=>t.type==="offer").length,")"]}),s.jsxs(h,{variant:d==="request"?"default":"outline",size:"sm",onClick:()=>p("request"),className:"flex-1",children:[a("common.requests")," (",l.filter(t=>t.type==="request").length,")"]})]})]})}),s.jsx("div",{className:"p-4 pb-20",children:_?s.jsx("div",{className:"grid grid-cols-2 gap-3",children:Array.from({length:12}).map((t,i)=>s.jsx(g,{loading:!0},i))}):b.length===0?s.jsxs("div",{className:"text-center py-12",children:[s.jsx("div",{className:"w-20 h-20 mx-auto mb-4 rounded-full bg-muted/50 flex items-center justify-center",children:s.jsx(M,{className:"h-8 w-8 text-muted-foreground"})}),s.jsx("h3",{className:"font-semibold text-lg mb-2",children:l.length===0?a("wishlist.emptyWishlist"):a("wishlist.noItemsFound")}),s.jsx("p",{className:"text-muted-foreground mb-6",children:l.length===0?a("wishlist.startAdding"):a("wishlist.tryAdjusting")}),l.length===0&&s.jsx(h,{onClick:I,variant:"outline",children:a("wishlist.exploreItems")})]}):s.jsx("div",{className:"grid grid-cols-2 gap-3",children:_?Array.from({length:12}).map((t,i)=>s.jsx(g,{loading:!0},i)):b.map(t=>t.type==="request"?m[t.id]?s.jsx(N,{request:m[t.id]},t.id):s.jsx(N,{request:{id:t.id,title:t.title}},t.id):m[t.id]?s.jsx(g,{offer:m[t.id]},t.id):s.jsx(g,{offer:{id:t.id,title:t.title}},t.id))})})]})}export{Z as WishlistsPage};
