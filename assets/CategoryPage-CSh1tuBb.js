import{u as w,r as s,j as t,R as I,P as Y}from"./index-CvO9pKPC.js";import{O as b}from"./OfferCard-Bdyy8poT.js";import{R as E}from"./RequestCardB-5Jaff5AR.js";import{I as L}from"./input-DnWsiyUA.js";import{o as $}from"./offersSupabaseService-BThdOnLG.js";import{r as M}from"./requestsSupabaseService-soQQ1D_i.js";import{S as P}from"./search-B_nDvCvE.js";import"./badge-CXoDSUIB.js";import"./wishlistStore-CfNM5_Pj.js";import"./ImageWithFallback--6Rpc7vq.js";import"./heart-DlE89daf.js";import"./common-Dk-gsxo2.js";import"./map-pin-BzPRdFpW.js";function D({children:m,onRefresh:o,refreshing:a=!1,disabled:c=!1,pullThreshold:x=50,maxPullDistance:f=80,refreshText:l="common.pullToRefresh",releaseText:y="common.releaseToRefresh",pullingText:g="common.refreshing",className:S=""}){const{t:u}=w(),[d,p]=s.useState(0),[n,j]=s.useState(!1),e=s.useRef(null),r=s.useRef(0),i=s.useRef(!0),v=s.useCallback(h=>{c||a||(e.current&&e.current.scrollTop===0?(r.current=h.touches[0].clientY,i.current=!0):i.current=!1)},[c,a]),R=s.useCallback(h=>{if(!i.current||a||c)return;const N=h.touches[0].clientY-r.current;if(N>0&&e.current&&e.current.scrollTop===0){h.preventDefault(),j(!0);const q=Math.min(N*.5,f);p(q)}},[a,c,f]),T=s.useCallback(async()=>{n&&!c&&(d>x&&await o(),j(!1),p(0))},[n,d,x,o,c]),k=s.useCallback(h=>{const C=h.currentTarget;i.current=C.scrollTop===0},[]);return t.jsxs("div",{ref:e,className:`overflow-y-auto ${S}`,onTouchStart:v,onTouchMove:R,onTouchEnd:T,onScroll:k,style:{transform:`translateY(${n?Math.min(d,f*.6):0}px)`,transition:n?"none":"transform 0.3s ease-out",paddingTop:n||a?"8px":"0px"},children:[t.jsx("div",{className:`flex justify-center ${n||a?"py-4":"py-0"} px-4 transition-all duration-300`,style:{opacity:n||a?1:0,height:n||a?"auto":0,overflow:"hidden"},children:t.jsxs("div",{className:"flex items-center justify-center space-x-2 text-muted-foreground bg-background/80 backdrop-blur-sm rounded-full px-4 py-2 shadow-sm",children:[t.jsx(I,{className:`h-4 w-4 ${a?"animate-spin":""}`}),t.jsx("span",{className:"text-sm font-medium",children:a?u(g):d>x?u(y):u(l)})]})}),m]})}function W({category:m}){const{t:o}=w(),[a,c]=s.useState(!1),[x,f]=s.useState(!1),[l,y]=s.useState(""),[g,S]=s.useState({title:"",description:"",requests:[],offers:[]}),u=s.useCallback(async(e=!1)=>{try{e?f(!0):c(!0);const r=await M.getRequests({category:m}),i=await $.getOffers({category:m});S({title:o(`categories.${m}`),description:o(`categories.${m}_description`),requests:r,offers:i})}catch(r){console.error("Error fetching category data:",r)}finally{c(!1),f(!1)}},[m,o]);s.useEffect(()=>{u()},[u]);const d=[...g.requests.map(e=>({...e,type:"request"})),...g.offers.map(e=>({...e,type:"offer"}))].sort((e,r)=>{const i=new Date(e.created_at||0);return new Date(r.created_at||0).getTime()-i.getTime()}),p=s.useMemo(()=>{let e=d;return l&&(e=e.filter(r=>r.title.toLowerCase().includes(l.toLowerCase())||(r.description||"").toLowerCase().includes(l.toLowerCase()))),e},[d,l]),n=e=>{y(e.target.value)},j=s.useCallback(async()=>{await u(!0)},[u]);return t.jsxs(D,{onRefresh:j,refreshing:x,className:"flex-1 bg-background",children:[t.jsx("div",{className:"px-4 pt-4 pb-4",children:t.jsxs("div",{className:"relative",children:[t.jsx(P,{className:"absolute left-3 top-3 h-5 w-5 text-muted-foreground"}),t.jsx(L,{placeholder:o("common.searchInCategory",{category:g.title}),value:l,onChange:n,className:"pl-10 pr-4 bg-input-background border-0 rounded-lg text-foreground placeholder:text-muted-foreground"})]})}),t.jsxs("div",{className:"px-4 py-6",children:[t.jsx("div",{className:"mb-4",children:t.jsx("span",{className:"text-muted-foreground text-sm",children:o("common.itemsFound",{count:p.length})})}),p.length===0?t.jsxs("div",{className:"text-center py-8",children:[t.jsx(Y,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),t.jsx("h3",{className:"text-lg font-medium text-foreground mb-2",children:o("common.noItemsFound")}),t.jsx("p",{className:"text-muted-foreground",children:o(l?"common.adjustSearchTerms":"common.noItemsInCategory")})]}):t.jsx("div",{className:"grid grid-cols-2 gap-3",children:a?Array.from({length:12}).map((e,r)=>t.jsx(b,{loading:!0},r)):p.map(e=>e.type==="request"?t.jsx(E,{request:e},e.id):t.jsx(b,{offer:e},e.id))})]})]})}export{W as CategoryPage};
