import{j as e,u as O,a as I,c as C,r as u,P as g,B as i}from"./index-CvO9pKPC.js";import{I as q}from"./ImageWithFallback--6Rpc7vq.js";import{B as p}from"./badge-CXoDSUIB.js";import{P as R}from"./progress-steps-BYrez380.js";import{c as z}from"./chatSupabaseService-C5-xj_cv.js";import{o as B}from"./offersSupabaseService-BThdOnLG.js";import{o as N}from"./ordersSupabaseService-C1vKZQTj.js";import{r as P}from"./requestsSupabaseService-soQQ1D_i.js";import"./wishlistStore-CfNM5_Pj.js";import{g as b,a as U,b as A,c as D,d as E,e as F,f as _}from"./orders-BbzWbzRe.js";import{S as a}from"./skeleton-D4u7SwtH.js";import{T as $}from"./truck-BV3tXDUF.js";import"./search-B_nDvCvE.js";import"./credit-card-DAW3eLy7.js";function T(){return e.jsx("div",{className:"space-y-4",children:[...Array(3)].map((t,c)=>e.jsxs("div",{className:"p-4 bg-muted/50 rounded-lg",children:[e.jsxs("div",{className:"flex space-x-4 mb-2",children:[e.jsx(a,{className:"w-16 h-16 rounded-lg flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx(a,{className:"h-5 w-20"}),e.jsx(a,{className:"h-5 w-24 ml-2"})]}),e.jsx(a,{className:"h-5 w-full mb-2"}),e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx(a,{className:"h-3 w-24"}),e.jsx(a,{className:"h-3 w-20"})]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(a,{className:"h-4 w-4 rounded"}),e.jsx(a,{className:"h-4 w-32"})]}),e.jsx(a,{className:"h-3 w-16"})]}),e.jsx(a,{className:"h-3 w-full mb-3"}),e.jsx(a,{className:"h-2 w-full rounded-full"})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx(a,{className:"h-4 w-24 mb-1"}),e.jsx(a,{className:"h-4 w-32"})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(a,{className:"h-9 flex-1 rounded-md"}),e.jsx(a,{className:"h-9 flex-1 rounded-md"})]})]},c))})}function te(){const{t}=O(),c=I(),{user:o}=C(),[x,v]=u.useState([]),[w,j]=u.useState(!0),[m,f]=u.useState("all");u.useEffect(()=>{o&&y()},[o,m]);const y=async()=>{try{j(!0);let s=[];m==="all"?s=await N.getOrders():s=await N.getOrders({role:m});const n=await Promise.all(s.map(async l=>{let r={};if(l.requestId){const d=await P.getRequestById(l.requestId);d&&(r.request=d,r.requestDeliveryMethod=d.delivery_method)}if(l.offerId){const d=await B.getOfferById(l.offerId);d&&(r.offer=d)}return{...l,...r}}));v(n)}catch(s){console.error("Error loading orders:",s)}finally{j(!1)}},k=async s=>{if(!o||o.id===s.agentUserId||o.id===s.clientUserId)return;const l=b(o,s)==="client"?s.agentUserId:s.clientUserId;try{const r=await z.getOrCreateConversation({participant_user_id:l,order_id:s.id});r?c(`/messages/chat/${r.id}`):console.error("Failed to create conversation")}catch(r){console.error("Error contacting agent:",r)}};return o?(console.log("[DEBUG] OrdersTab Rendered",x),e.jsxs("div",{className:"flex-1 bg-background pb-[74px]",children:[e.jsxs("div",{className:"bg-card px-4 pt-12 pb-6",children:[e.jsx("h1",{className:"text-3xl font-semibold text-foreground",children:t("nav.orders")}),e.jsx("p",{className:"text-muted-foreground mt-1",children:t("orders.description")})]}),e.jsxs("div",{className:"px-4 py-4",children:[e.jsxs("div",{className:"flex gap-2 mb-6",children:[e.jsx(i,{variant:m==="all"?"default":"outline",size:"sm",onClick:()=>f("all"),children:t("orders.allOrders")}),e.jsx(i,{variant:m==="client"?"default":"outline",size:"sm",onClick:()=>f("client"),children:t("orders.myRequests")}),e.jsx(i,{variant:m==="agent"?"default":"outline",size:"sm",onClick:()=>f("agent"),children:t("orders.myOffers")})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-6",children:[e.jsxs("div",{className:"p-4 text-center bg-muted/50 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-primary mb-1",children:x.length}),e.jsx("div",{className:"text-xs text-muted-foreground",children:t("orders.totalOrders")})]}),e.jsxs("div",{className:"p-4 text-center bg-muted/50 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600 mb-1",children:x.filter(s=>s.status==="completed").length}),e.jsx("div",{className:"text-xs text-muted-foreground",children:t("orders.completed")})]})]}),w?e.jsx(T,{}):x.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(g,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-foreground mb-2",children:t("orders.noOrdersYet")}),e.jsx("p",{className:"text-muted-foreground mb-6",children:t("orders.createRequestPrompt")}),e.jsx(i,{onClick:()=>c("/create"),children:t("orders.createRequest")})]}):e.jsx("div",{className:"space-y-4",children:x.map(s=>{const n=b(o,s),l=U(s.status,s.deliveryMethod),r=A(l,n,s.deliveryMethod),d=s.request?.title||s.offer?.title||t("orders.order"),S=s.request?.category||s.offer?.category||"",h=s.request?.images||s.offer?.images||[];return e.jsxs("div",{className:"p-4 bg-muted/50 rounded-lg",children:[e.jsxs("div",{className:"flex space-x-4 mb-2",children:[h&&h.length>0&&e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-16 h-16 rounded-lg overflow-hidden bg-muted",children:e.jsx(q,{src:h[0],alt:d,className:"w-full h-full object-cover"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx(p,{variant:D(n),className:"text-xs flex-shrink-0",children:t(E(n))}),e.jsx(p,{variant:F(s.status),className:"ml-2 flex-shrink-0",children:t(_(s.status))})]}),e.jsx("h3",{className:"font-semibold text-foreground mb-2 leading-tight",children:d}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground mb-3",children:[e.jsx("span",{children:t(`categories.${S}`)}),e.jsxs("span",{className:"font-semibold text-foreground",children:[s.currency," ",s.totalAmount.toFixed(2)]})]})]})]}),s.status!=="cancelled"&&s.status!=="refunded"&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(r.icon,{className:"h-4 w-4 text-primary"}),e.jsx("span",{className:"text-sm font-medium",children:t(r.label)})]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:t("orders.stepOf",{current:l,total:5})})]}),e.jsx("p",{className:"text-xs text-muted-foreground mb-3",children:t(r.description)}),s.deliveryMethod!=="personal_handoff"&&s.trackingNumber&&e.jsx("div",{className:"mb-3 p-3 bg-background rounded-lg border",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx($,{className:"h-3 w-3 text-muted-foreground"}),e.jsx("span",{className:"text-xs font-mono text-foreground",children:s.trackingNumber})]})}),e.jsx(R,{currentStep:l,numberOfSteps:5,className:"px-0 py-2"})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:t(n==="client"?"orders.shoppingAgent":"orders.client")}),e.jsx("p",{className:"font-medium",children:n==="client"?s.agent?.nickname||"Agent":s.client?.nickname||"Client"})]}),s.status==="completed"?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(i,{variant:"outline",size:"sm",className:"flex-1",onClick:()=>c(`/orders/${s.id}`),children:t("orders.details")}),e.jsx(i,{variant:"outline",size:"sm",className:"flex-1",onClick:()=>c(`/orders/${s.id}/feedback`),children:t("orders.viewFeedback")})]}),e.jsx(i,{variant:"default",size:"sm",className:"w-full",onClick:()=>c(`/orders/${s.id}/leave-feedback`),children:t("orders.leaveFeedback")})]}):e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(i,{variant:"outline",size:"sm",className:"flex-1",onClick:()=>c(`/orders/${s.id}`),children:t("orders.details")}),e.jsx(i,{variant:"outline",size:"sm",className:"flex-1",onClick:()=>k(s),children:t(n==="client"?"orders.contactAgent":"orders.contactClient")})]})]},s.id)})})]})]})):e.jsxs("div",{className:"flex-1 bg-background pb-[74px]",children:[e.jsxs("div",{className:"bg-card px-4 pt-12 pb-6",children:[e.jsx("h1",{className:"text-3xl font-semibold text-foreground",children:t("nav.orders")}),e.jsx("p",{className:"text-muted-foreground mt-1",children:t("orders.description")})]}),e.jsx("div",{className:"px-4 py-8",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(g,{className:"h-16 w-16 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-foreground mb-2",children:t("orders.signInPrompt")}),e.jsx("p",{className:"text-muted-foreground mb-6",children:t("orders.signInDescription")}),e.jsx(i,{onClick:()=>c("/auth/signin"),className:"px-8",children:t("profile.signIn")})]})})]})}export{te as OrdersTab};
