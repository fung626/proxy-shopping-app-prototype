import{s}from"./index-CvO9pKPC.js";class c{async getRequests(r){try{let e=s.from("requests").select("*");r?.category&&(e=e.eq("category",r.category)),r?.location&&(e=e.or(`expected_delivery_location.ilike.%${r.location}%,designated_purchasing_location.ilike.%${r.location}%`)),r?.budgetMin&&(e=e.gte("budget_min",r.budgetMin)),r?.budgetMax&&(e=e.lte("budget_max",r.budgetMax)),r?.urgency&&(e=e.eq("urgency",r.urgency)),r?.status&&(e=e.eq("status",r.status)),r?.limit&&(e=e.limit(r.limit)),r?.offset&&(e=e.range(r.offset,r.offset+(r.limit||10)-1)),e=e.order("created_at",{ascending:!1});const{data:t,error:o}=await e;if(o)throw console.error("Error fetching requests:",o),o;return t||[]}catch(e){throw console.error("Error in getRequests:",e),e}}async getTrendingRequests(r=6){try{const{data:e,error:t}=await s.from("requests").select("*").limit(r).order("created_at",{ascending:!1});if(t)throw console.error("Error fetching trending requests:",t),t;return e||[]}catch(e){throw console.error("Error in getTrendingRequests:",e),e}}async getRequestById(r){try{const{data:e,error:t}=await s.from("requests").select("*").eq("id",r).single();if(t)throw console.error("Error fetching request:",t),t;return e}catch(e){throw console.error("Error in getRequestById:",e),e}}async getRequesByIds(r){try{const{data:e,error:t}=await s.from("requests").select("*").in("id",r).order("created_at",{ascending:!1});if(t)throw console.error("Error fetching requests by IDs:",t),t;return e||[]}catch(e){throw console.error("Error in getRequesByIds:",e),e}}async createRequest(r){try{const e=new Date().toISOString(),t={user_id:r.user_id,user_name:r.user_name,title:r.title,description:r.description,specific_requirements:r.specific_requirements||[],category:r.category,budget_min:r.budget_min,budget_max:r.budget_max,currency:r.currency||"USD",product_origin:r.product_origin,designated_purchasing_location:r.designated_purchasing_location,expected_delivery_location:r.expected_delivery_location,expected_delivery:r.expected_delivery,shipping_address:r.shipping_address,delivery_method:r.delivery_method||"personal_handoff",images:r.images||[],created_at:e,updated_at:e,status:r.status||"active",urgency:r.urgency||"normal"},{data:o,error:n}=await s.from("requests").insert([t]).select().single();if(n)throw console.error("Error creating request:",n),n;return o}catch(e){throw console.error("Error in createRequest:",e),e}}async updateRequest(r,e){try{const{data:t,error:o}=await s.from("requests").update({...e,updated_at:new Date().toISOString()}).eq("id",r).select().single();if(o)throw console.error("Error updating request:",o),o;return t}catch(t){throw console.error("Error in updateRequest:",t),t}}async deleteRequest(r){try{const{error:e}=await s.from("requests").delete().eq("id",r);if(e)throw console.error("Error deleting request:",e),e;return!0}catch(e){throw console.error("Error in deleteRequest:",e),e}}async getRequestsByCategory(r,e){try{let t=s.from("requests").select("*").eq("category",r).order("created_at",{ascending:!1});e&&(t=t.limit(e));const{data:o,error:n}=await t;if(n)throw console.error("Error fetching requests by category:",n),n;return o||[]}catch(t){throw console.error("Error in getRequestsByCategory:",t),t}}async getRequestsByUser(r){try{const{data:e,error:t}=await s.from("requests").select("*").eq("user_id",r).order("created_at",{ascending:!1});if(t)throw console.error("Error fetching requests by user:",t),t;return e||[]}catch(e){throw console.error("Error in getRequestsByUser:",e),e}}async getUrgentRequests(r=10){try{const{data:e,error:t}=await s.from("requests").select("*").eq("urgency","urgent").limit(r).order("created_at",{ascending:!1});if(t)throw console.error("Error fetching urgent requests:",t),t;return e||[]}catch(e){throw console.error("Error in getUrgentRequests:",e),e}}async searchRequests(r,e){try{let t=s.from("requests").select("*").or(`title.ilike.%${r}%,description.ilike.%${r}%`);e?.category&&(t=t.eq("category",e.category)),e?.location&&(t=t.or(`expected_delivery_location.ilike.%${e.location}%,designated_purchasing_location.ilike.%${e.location}%`)),e?.budgetMin&&(t=t.gte("budget_min",e.budgetMin)),e?.budgetMax&&(t=t.lte("budget_max",e.budgetMax)),e?.urgency&&(t=t.eq("urgency",e.urgency)),e?.limit&&(t=t.limit(e.limit)),t=t.order("created_at",{ascending:!1});const{data:o,error:n}=await t;if(n)throw console.error("Error searching requests:",n),n;return o||[]}catch(t){throw console.error("Error in searchRequests:",t),t}}}const d=new c;async function u(i){try{const{data:r,error:e}=await s.from("requests").select("*").eq("id",i).single();if(e)throw console.error("Error fetching request:",e),e;return{id:r.id,title:r.title,description:r.description||"",status:r.status||"Active",step:1,role:"client",agent:r.offers?.[0]?.user_name,client:r.user_name,location:r.expected_delivery_location||"",createdDate:r.created_at,category:r.category||"",deliveryMethod:r.delivery_method,budget:r.budget_min?`${r.budget_min}-${r.budget_max}`:void 0,timeline:r.expected_delivery?.start,requirements:r.specific_requirements,images:r.images,isPurchased:!1,isShipped:!1,purchaseDate:void 0,shippingDate:void 0,trackingNumber:void 0}}catch(r){throw console.error("Error in getRequestById:",r),r}}export{u as g,d as r};
